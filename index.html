<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Safari Storage Access Test</title>
</head>
<body>
  <h2>Iframe Storage Access Test (Safari)</h2>
  <button id="setCookie">Set Test Cookie</button>
  <button id="checkAccess">Check Storage Access</button>
  <button id="requestAccess">Request Storage Access</button>
  <p id="status"></p>

  <script>
    const status = document.getElementById("status");

    function log(msg) {
      console.log(msg);
      status.innerText = msg;
    }

    // Helper: set a test cookie
    document.getElementById("setCookie").addEventListener("click", () => {
      document.cookie = "testcookie=1; SameSite=None; Secure";
      localStorage.setItem("testLocalStorage", Date.now());
      log("üç™ Test cookie & localStorage set.");
    });

    // Check if API is supported
    if (document.hasStorageAccess) {
      log("requestStorageAccess API is supported.");
    } else {
      log("requestStorageAccess API is NOT supported in this browser.");
    }

    // Button: check current access
    document.getElementById("checkAccess").addEventListener("click", async () => {
      if (!document.hasStorageAccess) {
        log("API not available.");
        return;
      }
      try {
        const hasAccess = await document.hasStorageAccess();
        log(hasAccess ? "‚úÖ Storage access already granted." : "‚ùå No storage access yet.");
      } catch (err) {
        log("Error checking access: " + err);
      }
    });

    // Button: request access
    document.getElementById("requestAccess").addEventListener("click", async () => {
      if (!document.requestStorageAccess) {
        log("API not available.");
        return;
      }
      try {
        await document.requestStorageAccess();
        log("üéâ Storage access granted! You can now read/write cookies/localStorage.");
        // Try reading back cookie
        log("Cookies now: " + document.cookie);
      } catch (err) {
        log("‚ùå Access request denied: " + err);
      }
    });
  </script>
</body>
</html>
